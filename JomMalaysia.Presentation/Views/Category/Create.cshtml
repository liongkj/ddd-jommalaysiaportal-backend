@model JomMalaysia.Presentation.Models.CategoryViewModel

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!--HEADER-->
<div class="form-group col-md-12 no-padding d-none d-md-block">
    <button type="button" class="btn btn-success col-md-2" onclick="$('#btnSubmit').click()">New</button>
    <button type="button" class="btn btn-primary col-md-2" onclick="window.location.href = '@Url.Action("Edit","Category")'">Edit</button>
    <button type="button" class="btn btn-danger col-md-2" onclick="window.location.href = '@Url.Action("Delete","Category")'">Delete</button>
    <button type="button" class="btn btn-secondary col-md-2" onclick="window.location.href = '@Url.Action("Publish","Category")'">Publish</button>
</div>
<div class="form-group col-md-12 no-padding d-sm-block d-md-none">
    <div class="btn-group col-sm-12 no-padding" role="group">
        <button type="button" class="btn btn-primary">Action</button>
        <div id="dropdown-action-button" class="dropdown-menu col-sm-12" aria-labelledby="btnGroupDrop1" x-placement="bottom-start" style="display:none; position: absolute; transform: translate3d(0px, 35px, 0px); top: 0px; left: 0px; will-change: transform;">
            <a class="dropdown-item" onclick="$('#btnSubmit').click()">Save</a>
            <a class="dropdown-item" onclick="window.location.href = '@Url.Action("Delete","Category")'">Cancel</a>
        </div>
        <div id="action-button" class="btn-group" role="group">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
        </div>
    </div>
</div>
<!--END OF HEADER-->

<form asp-action="Create" id="CreateCategoryForm" class="form-m-gap-top">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <div class="form-group row">
        <div class="col-sm-2 col-md-3 col-form-label">@Html.DisplayNameFor(m => m.CategoryCode)</div>
        <div class="col-sm-10 col-md-6">
            @Html.TextBoxFor(m => m.CategoryCode, new { @class = "form-control"})
            @Html.ValidationMessageFor(m => m.CategoryCode)
            @*<input type="text" class="form-control" id="txtSSMID" placeholder="Enter SSM ID">*@
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2 col-md-3 col-form-label">@Html.DisplayNameFor(m => m.CategoryName)</div>
        <div class="col-sm-10 col-md-6">
            @Html.TextBoxFor(m => m.CategoryName, new { @class = "form-control"})
            @Html.ValidationMessageFor(m => m.CategoryName)
            @*<input type="text" class="form-control" id="txtSSMID" placeholder="Enter SSM ID">*@
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2 col-md-3 col-form-label">@Html.DisplayNameFor(m => m.CategoryNameMs)</div>
        <div class="col-sm-10 col-md-6">
            @Html.TextBoxFor(m => m.CategoryNameMs, new { @class = "form-control"})
            @Html.ValidationMessageFor(m => m.CategoryNameMs)
            @*<input type="text" class="form-control" id="txtSSMID" placeholder="Enter SSM ID">*@
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2 col-md-3 col-form-label">@Html.DisplayNameFor(m => m.CategoryNameZh)</div>
        <div class="col-sm-10 col-md-6">
            @Html.TextBoxFor(m => m.CategoryNameZh, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.CategoryNameZh)
            @*<input type="text" class="form-control" id="txtSSMID" placeholder="Enter SSM ID">*@
        </div>
    </div>
    <button id="new-subcategory" type="button" class="btn btn-success col-md-2">New SubCategory</button>
    <div class="col-md-12 col-sm-12 no-padding" style="overflow-x:auto !important" ;">
        <table class="table table-hover tb-subcategory">
            <thead class="table-primary">
                <tr>
                    <th scope="col">Sub Category ID</th>
                    <th scope="col">Sub Category Name</th>
                    <th scope="col">Sub Category Name Ms</th>
                    <th scope="col">Sub Category Name Zh</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                <tr id="subcategory-0">
                    @*https://stackoverflow.com/questions/38929009/how-to-bind-an-array-in-mvc-core
                        https://fildev.net/2017/05/14/send-array-from-view-to-controller-as-class-asp-net-core/*@
                    <td>
                        @Html.TextBoxFor(m => m.LstSubCategory[0].CategoryCode, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.LstSubCategory[0].CategoryCode)
                    </td>
                    <td>
                        @Html.TextBoxFor(m => m.LstSubCategory[0].CategoryName, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.LstSubCategory[0].CategoryName)
                    </td>
                    <td>
                        @Html.TextBoxFor(m => m.LstSubCategory[0].CategoryNameMs, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.LstSubCategory[0].CategoryNameMs)
                    </td>
                    <td>
                        @Html.TextBoxFor(m => m.LstSubCategory[0].CategoryNameZh, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.LstSubCategory[0].CategoryNameZh)
                    </td>
                    <td>
                        @Html.HiddenFor(m => m.LstSubCategory[0].IsDeleted, new { @class = "form-control" })
                    </td>
                    @*<td><input type="text" id="subcategoryID-0" class="form-control" /></td>
                        <td><input type="text" id="subcategoryName-0" class="form-control" /></td>
                        <td><input type="text" id="subcategoryNameMs-0" class="form-control" /></td>*@
                    <td><button id="delete-subcategory" type="button" class="btn btn-danger invisible isDelete">Delete</button></td>
                </tr>
            </tbody>
        </table>
    </div>
    <button id="btnSubmit" type="button" class="d-none"></button>
</form>

<div>
    <a class="d-flex justify-content-end" asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="js/form-validation.js"></script>
    <script type="text/javascript">
        //------------------------ Add Subcategory ----------------------
        $(document).ready(function () {

            var counter = 1;

            $("#new-subcategory").on("click", function () {
                var newRow = $("<tr>");
                var cols = "";

                cols += '<td> <input class="form-control" id="lstSubCategory_' + counter + '__categoryId" name="lstSubCategory[' + counter + '].categoryId" type="text" value=""></td>'
                cols += '<td> <input class="form-control" id="lstSubCategory_' + counter + '__categoryName" name="lstSubCategory[' + counter + '].categoryName" type="text" value=""></td>'
                cols += '<td> <input class="form-control" id="lstSubCategory_' + counter + '__categoryNameMs" name="lstSubCategory[' + counter + '].categoryNameMs" type="text" value=""></td>'
                cols += '<td> <input class="form-control" id="lstSubCategory_' + counter + '__categoryNameZh" name="lstSubCategory[' + counter + '].categoryNameZh" type="text" value=""></td>'
                cols += '<td> <input class="isDelete form-control" data-val="true" id="lstSubCategory_' + counter + '__isDeleted" name="lstSubCategory[' + counter + '].isDeleted" type="hidden" value=""></td>'
                cols += '<td> <button type="button" class="btn btn-danger btnDelete">Delete</button></td> ';

                newRow.append(cols);
                $(".tb-subcategory").append(newRow);
                counter++;
            });

            $(".tb-subcategory").on("click", ".btnDelete", function (event) {
                $(this).closest("tr").addClass("d-none");
                $(this).closest("tr").find('.isDelete').val("true");
                //lstSubCategory_0__categoryId
                //$(this).closest('tr').find('#isDeleted').prop('checked', true);
            });

            //------------------------ Validate ----------------------
            $('#btnSubmit').click(function () {
                debugger;
                $("#CreateCategoryForm").valid();
            });

            $("#CreateCategoryForm").validate({
                rules: {
                    categoryName: {
                        required: true
                    }
                },
                messages: {
                    categoryName: {
                        required: "We need your email address to contact you"
                    }
                },
                submitHandler: function(form) {
                    form.submit();
                }
            });
        });
       

    </script>
}
